targets += bin
targets += bin/with-stack-protector
targets += bin/no-stack-protector
targets += bin/no-stack-protector-foiled
targets += bin/with-aslr

.PHONY: all clean

all: $(targets)

clean:
	rm -rf bin
	rm -f src/*.o

bin/with-stack-protector: src/with-stack-protector.c | bin
	$(CC) -g -pie -fPIC -fstack-protector-all $< -o $@

bin/no-stack-protector: src/no-stack-protector.c | bin
	$(CC) -g -pie -fPIC -fno-stack-protector $< -o $@

bin/no-stack-protector-foiled: src/no-stack-protector.c | bin
	$(CC) -g -pie -fPIC -fstack-protector-all $< -o $@

bin/with-aslr: src/with-aslr.c | bin
	$(CC) -g -pie -fPIC -fstack-protector-all $< -o $@

bin:
	mkdir -p $@
