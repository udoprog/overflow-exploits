#include <string.h>
#include <stdlib.h>
#include <stdio.h>

void __attribute__ ((noinline)) bad();
void __attribute__ ((noinline)) foo();

void bad() {
    printf("Oh no :(\n");
    exit(0);
}

void helper(const char* buffer) {
    printf("Everything is reversed :): %s\n", buffer);
}

void foo() {
    char buffer[64];
    void (*h)() = helper;

    memset(buffer, 'a', 64);

    int l = 1;
    int c = 0;

    // read the string in reverse.
    while ((c = getchar()) != EOF) {
        buffer[sizeof(buffer) - ++l] = c;
    }

    buffer[sizeof(buffer) - 1] = 0;

    const char* reversed = buffer + sizeof(buffer) - l;
    h(reversed);
}

int main() {
    printf("bad = %p\n", bad);
    printf("helper = %p\n", helper);
    foo();
    return 0;
}
